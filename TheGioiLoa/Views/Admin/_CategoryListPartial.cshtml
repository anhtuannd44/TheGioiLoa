@model TheGioiLoa.Models.ViewModel.CategoryViewModel


<div class="card card-widget widget-user-2">
    <div class="card-header bg-primary">
        <h3 class="card-title">Danh Mục Sản Phẩm</h3>
    </div>
    <div class="card-body p-0">
        <input hidden id="notification" value="@Model.Notification" />
        @foreach (var item in Model.CategoryList)
        {
            <div class="card p-0 m-0 rounded-0 border-top-0 border-right-0 border-left-0 shadow-none border-bottom collapsed-card">
                <div class="card-header border-0">
                    <a href="#" class="card-title font-weight-bold h3"
                       onclick="showModalEditCategory(this)"
                       data-toggle="modal"
                       data-target="#editCategoryModal"
                       data-id="@item.CategoryId"
                       data-name="@item.Name"
                       data-parent-id="null"
                       data-parent-name="null">
                        @item.Name
                    </a>
                    @if (item.CategoryChildList.Count() != 0)
                    {
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    }
                </div>
                <div class="card-body pb-1 pt-0 border-0" style="display: none;">
                    @foreach (var child in item.CategoryChildList)
                    {
                        <a href="" class="nav-link" onclick="showModalEditCategory(this)"
                           data-toggle="modal"
                           data-target="#editCategoryModal"
                           data-id="@child.CategoryId"
                           data-name="@child.Name"
                           data-parent-id="@item.CategoryId"
                           data-parent-name="@item.Name">
                            <i class="fa fa-angle-right mr-2"></i>
                            @child.Name
                        </a>

                    }
                </div>
            </div>
        }
    </div>
    <div id="loadingGift">
        <div class="position-relative h-100 w-100">
            <div class="loadingio-spinner-spinner-0g9wfi70d3hr">
                <div class="ldio-dmto02pujx">
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editCategoryModal" style="display: none;" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" id="editCategoryContent">
            @using (Ajax.BeginForm("EditCategory", new AjaxOptions
            {
                HttpMethod = "POST",
                UpdateTargetId = "categoryList",
                OnBegin = "showBgOverlay",
                OnSuccess = "loadingNoti",
                OnComplete = "closeModel"
            }))
            {
                <div class="overlay d-flex justify-content-center align-items-center" id="loadingModal">
                    <i class="fas fa-2x fa-sync fa-spin"></i>
                </div>
                <div class="modal-header">
                    <h4 class="modal-title" id="titleModal">Chỉnh sửa danh mục</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input hidden type="text" id="CategoryId" name="CategoryIdEdit" />
                    <div class="form-group">
                        <label for="editCategoryName">Tên danh mục</label>
                        <input type="text" name="Name" id="Name" class="form-control input-form-name" />
                    </div>
                    <div class="form-group">
                        <div class="custom-control custom-checkbox">
                            <input class="custom-control-input IsCategoryParentEdit" type="checkbox" id="IsCategoryParentEdit" name="IsCategoryParent" onclick="isParentCheckBox('Edit')">
                            <label for="IsCategoryParentEdit" class="custom-control-label">Là danh mục con của?</label>
                        </div>
                    </div>
                    <div class="form-group" id="categoryParentEdit">
                        @Html.DropDownList("CategoryParentId", null, htmlAttributes: new { @class = "form-control", id="CategoryIds" })
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Thoát</button>
                    <button type="submit" class="btn btn-primary">Lưu Lại</button>
                </div>
            }
        </div>
    </div>
</div>