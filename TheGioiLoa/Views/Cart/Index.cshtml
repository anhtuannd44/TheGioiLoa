@model IEnumerable<TheGioiLoa.Models.ViewModel.CartViewModel>
@{
    ViewBag.Title = "Giỏ Hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var totalPrice = TheGioiLoa.Models.ShoppingCart.Cart.TotalPrice;
    var totalPriceSale = TheGioiLoa.Models.ShoppingCart.Cart.TotalPriceSale;
}
<div class="container">
    <ul class="top-checkout">
        <li class="active"><a id="shoppingCart" href="javascript:void(0)"><i class="number">1</i>Giỏ hàng của bạn</a></li>
        <li><a id="" href="javascript:void(0)"><i class="number">2</i>Thông tin & Thanh toán</a></li>
        <li><a id="nk-hoan-tat-don-hang" href="javascript:void(0)"><i class="number">3</i>Hoàn tất đơn hàng</a></li>
    </ul>
</div>

<div class="container mb-4">
    <div class="row">
        <div class="col-md-8 col-md-8 col-lg-8 col-lg-8 col-xs-12">
            <div class="card card-shadow card-information">
                <div class="h-100 position-absolute w-100 loading-gift" id="loadingGif_Details" style="z-index: 9999; background: rgba(255,255,255,.7); display: none">
                    <img src="~/Content/Home/loading.gif" width="30" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);" />
                </div>
                <div class="card-body cart-content" id="cartContent" data-value="step1">
                    <h5 class="card-title">Giỏ hàng của bạn</h5>
                    <hr />
                    <div class="cartInformation" id="cartDetails">
                        @Html.Partial("_CartDetailPartial", Model)
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-md-4 col-lg-4 col-md-4 col-xs-12">
            <div class="card card-shadow mb-4">
                <div class="h-100 position-absolute w-100 loading-gift" id="loadingGif_Total" style="z-index: 9999; background: rgba(255,255,255,.7); display: none">
                    <img src="~/Content/Home/loading.gif" width="30" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);" />
                </div>
                <div class="card-body box-payment" id="cartTotal">
                    @Html.Partial("_CartTotalPartial", Model)
                </div>
            </div>
            <div class="cart-continue mb-4 text-right">
                <a href="@Url.Action("CheckOut","Cart")" class="btn btn-success btn-block h4 py-3" style="font-size: 1.2rem">TIẾP THEO<i class="fa fa-arrow-circle-right ml-3"></i></a>
            </div>
            <div class="card card-shadow">
                <div class="card-header bg-white p-0" id="headingOne">
                    <h5 class="mb-0">
                        <a href="#promotion" class="btn btn-link btn-block text-left py-3 text-dark px-4" data-toggle="collapse">
                            Bạn có mã giảm giá? Click vào đây!
                        </a>
                    </h5>
                </div>

                <div id="promotion" class="collapse">
                    <div class="card-body">
                        Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably haven't heard of them accusamus labore sustainable VHS.
                    </div>
                </div>

            </div>

        </div>
    </div>
</div>


@section heads {
    <style type="text/css">
        body {
            background: #f3f5f7;
        }
    </style>
}
@section scripts{
    <script>

        // Xóa khỏi giỏ
        function deleteItem(e) {
            $(".loading-gift").show();
            removeItem($(e).attr("data-id"));
        };

        function removeItem(productId) {
            $.ajax({
                method: "POST",
                url: "/Cart/Remove",
                data: { productId: productId },
                success: function () {
                    updateCart();
                }
            });
        }
        function changeCountItem(productId, isCount) {
            $(".loading-gift").show();
            $.ajax({
                method: "POST",
                url: "/Cart/Update",
                data: { productId: productId, isCount: isCount },
                success: function () {
                    updateCart();
                }
            });
        }

        function updateCart() {
            $.ajax({
                method: "POST",
                url: "/Cart/LoadCartDetails",
                success: function (data) {
                    $("#cartDetails").html(data);
                    $("#loadingGif_Details").hide();
                    $.ajax({
                        method: "POST",
                        url: "/Cart/LoadCartTotal",
                        success: function (data) {
                            $("#cartTotal").html(data);
                            $("#loadingGif_Total").hide();
                        }
                    });
                }
            });


        }


        // Cập nhật số lượng
        function changeCount(e) {
            $(".loading-gift").show();
            var isCount = (/true/i).test($(e).attr("data-count"));
            var productId = $(e).attr("data-id");
            changeCountItem(productId, isCount);
        };

    </script>
}

